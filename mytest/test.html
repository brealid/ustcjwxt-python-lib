<!DOCTYPE html>

<html lang="zh" xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title id="home_page_title">中国科学技术大学综合教务系统</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=1300,initial-scale=1.0,maximum-scale=1,user-scalable=yes" />
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <!--<title layout:title-pattern="$DECORATOR_TITLE - $CONTENT_TITLE" th:text="#{system.title}">教务系统</title>-->

  <link rel="icon" type="image/x-icon" href="/static/favicon.ico" />
  <link rel="stylesheet" href="/static/eams-ui/css/eams-ui.css?v=00003" />
  <link rel="stylesheet" href="/static/eams-ui/css/eams-ui-plugin.min.css?v=00004" />
  <link rel="stylesheet" href="/static/helper/css/info-page.css?v=00002" />
  <link rel="stylesheet" href="/static/helper/css/generate-template.css?v=00002" />
  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="/static/eams-ui/js/html5shiv.min.js?v=00002"></script>
  <script src="/static/eams-ui/js/respond.min.js?v=00002"></script>
  <![endif]-->

  <script src="/static/eams-ui/js/eams-ui.min.js?v=1"></script>
  <!--<script th:src="@{/static/eams-ui/js/eams-ui.js?v=1}"></script>-->
  <script src="/static/eams-ui/js/eams-ui.zh.min.js?v=00002"></script>
  <script>
    // 设置 context path, js会需要用
    window.CONTEXT_PATH = '';
    window.LOCALE = 'zh';
  </script>
  <script type="text/javascript" src="/static/helper/ustc-common-helper.js?v=3"></script>
  <script type="text/javascript" src="/static/helper/search-page-helper1.js?v=00003"></script>
  <script type="text/javascript" src="/static/helper/search-form-helper.js"></script>
  <script type="text/javascript" src="/static/helper/notIndex-page-helper.js?v=00003"></script>
  <script type="text/javascript" src="/static/helper/info-page.js?v=00003"></script>
  <script type="text/javascript" src="/static/helper/student-selectize.js?v=00003"></script>
  <script type="text/javascript" src="/static/helper/datatable-column-tools.js?v=00004"></script>
  <script type="text/javascript" src="/static/thymeleaf-component/common.js?v=00005"></script>
  <script src="/static/eams-ui/js/global-iconfont.js?v=00000"></script>
  <script>
    /*<![CDATA[*/
    $(function () {
      var infoMessages = null;
      if (!infoMessages) {
        infoMessages = [];
      }
      $.each(infoMessages, function (index, message) {
        new PNotify({
          title: '消息',
          text: message,
          type: 'info',
          delay: 1000
        });
      });

      var successMessages = null;
      if (!successMessages) {
        successMessages = [];
      }
      $.each(successMessages, function (index, message) {
        new PNotify({
          title: '成功',
          text: message,
          type: 'success',
          delay: 1000
        });
      });

      var errorMessages = null;
      if (!errorMessages) {
        errorMessages = [];
      }
      $.each(errorMessages, function (index, message) {
        new PNotify({
          title: '错误',
          text: message,
          type: 'error',
          delay: 5000
        });
      });

      var noticeMessages = null;
      if (!noticeMessages) {
        noticeMessages = [];
      }
      $.each(noticeMessages, function (index, message) {
        new PNotify({
          title: '提示',
          text: message,
          type: 'notice',
          delay: 1000
        });
      });

      $(document).ajaxError(function (event, request) {

        if (request.responseText && request.status == 200 && request.statusText == "parsererror") {
          window.location.href = self.location.href;
        }

        if (!request.responseJSON) {
          return;
        }

        var data = {};
        var message = request.responseJSON.message;
        if (request.responseJSON.errors && request.responseJSON.errors.length > 0) {
          message = request.responseJSON.errors[0].defaultMessage;
        }
        data['errError'] = request.responseJSON.error;
        data['errException'] = request.responseJSON.exception;
        data['errMessage'] = message;
        data['errPath'] = request.responseJSON.path;
        data['errStatus'] = request.responseJSON.status + ' (' + request.responseJSON.cookieString + ')';
        data['errTimestamp'] = request.responseJSON.timestamp;
        data['errTrace'] = request.responseJSON.trace;

        new PNotify({
          text: request.responseJSON.prompt,
          type: 'error',
          delay: 50000,
          icon: false,
          width: '350px',
          min_height: '82px',
          confirm: {
            confirm: true,
            align: 'right',
            buttons: [
              {
                text: '上报错误',
                addClass: "btn-sm",
                click: function () {
                  $.post({
                    url: window.CONTEXT_PATH +'/sys-error-msg/save',
                    contentType: 'application/json',
                    dataType: 'json',
                    data: JSON.stringify(data),
                    success: function (response) {
                      if ($(".bootbox-alert").length == 0) {
                        bootbox.alert(response.content);
                      }
                    }
                  })
                }
              }, {addClass: 'hide'}
            ]
          }
        });

      });

    });

    window.preventFromSubmitTwice = function($form) {
      $form.submit(function() {
        $(this).submit(function() {
          return false;
        });
        return true;
      });
    }
    window.preventFromSubmitTwice($('#save-form'));

    window.semesterURIUtil = function (originalUri, insertBefore, semesterId) {
      var semesterPattern = "/semester/";
      if (originalUri.indexOf(semesterPattern) != -1) {
        // remove semester pattern
        var semesterPatternStartAt = originalUri.indexOf(semesterPattern);
        var semesterPatternEndAt = semesterPatternStartAt +
            originalUri.substring(semesterPatternStartAt, originalUri.length).indexOf("/", semesterPattern.length);
        originalUri = originalUri.substring(0, semesterPatternStartAt) + originalUri.substring(semesterPatternEndAt, originalUri.length);
      }
      var appendIndex = originalUri.indexOf(insertBefore);
      return originalUri.substring(0, appendIndex) + semesterPattern + semesterId + originalUri.substring(appendIndex, originalUri.length);
    };


//    eamsUiUtil.cascadeScrollParentWindowToTop(window);

    /*]]>*/
  </script>
  <link rel="stylesheet" href="/static/system/pathNav.css?v=00002" />
  <style type="text/css" media="print">
    .path-nav {
      display: none
    }
  </style>
  <style type="text/css">
    .path-nav{
      color: #999999;
      padding:10px 10px;
    }
    #refresh{
      margin-left:10px;
      cursor:pointer;
      background-color:#eee;
      transition:ease 0.3s;
      color:#999;
      border-radius: 4px;
    }
    #refresh:hover{
      color:#fff;
      background-color:#428bca;
    }
    .selectize-dropdown {
      width: auto !important;
      min-width: 100%;
    }

    .selectize-dropdown-content > div.option {
      white-space: nowrap;
    }
  </style>
	<link rel="icon" type="image/x-icon" href="/static/favicon.ico" />
	<link rel="stylesheet" href="/static/eams-ui/css/font-awesome.min.css" />
	<link rel="stylesheet" href="/static/home/css/ustc-ui-home.css?v=3" />
	<link rel="stylesheet" href="/static/todo/css/todo.css" />
	<link rel="stylesheet" href="/static/home/css/index.css?v=001" />
	<script type="text/javascript" src="/static/cryptoJS/sha1.js"></script>
</head>

<!-- thymeleaf自定义组件代码锚点 -->
<script compo="true"></script>
<!-- thymeleaf自定义组件代码锚点 -->

<body class="e-home e-home-bg1">
<div class="path-nav hide">
  <span>您的当前位置：<span id="path-nav-home"></span></span>   <button id="refresh" class="btn btn-xs">刷新</button>
</div>
<div class="clearfix"></div>
<body class="e-home e-home-bg1">


<!-- 顶部导航栏 -->
<header class="e-header">
  <input id="saveMenus" type="hidden" />

  <nav class="navbar navbar-static-top home-active" role="navigation">

    <!--<div class="container-fluid">-->

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse">

      <ul class="nav navbar-nav e-navbar-nav-1" id="e-top-menu">
      </ul>

      <ul class="nav navbar-nav" id="e-top-home-page">
        <li class="tabLi active">
          <a href="welcome/" id="e-home-tab-home" target="e-home-iframe"> 首页 </a>
        </li>
      </ul>

      <ul class="toolbarView nav navbar-nav "></ul>


      <!--<ul class="nav navbar-nav navbar-right e-navbar-nav-3 " style="padding: 0; display: flex; min-width: 200px">-->
      <ul class="nav navbar-nav navbar-right e-navbar-nav-3 " style="padding: 0; display: flex; ">
        <!-- 意见反馈 -->
        <li><a class="list-item" href="https://support.qq.com/product/86840" id="suggestions" target="_blank"><span>意见反馈</span></a></li>
        <li class="dropdown hidden-sm hidden-xs" id="identity-change" style="flex: 0 1 auto; ">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#" style="padding-left: 0px">
            <div class="identity-change-div">
              <span>学生</span>
              <i class="fa fa-angle-down"></i>
            </div>

          </a>
          <ul class="dropdown-menu" role="menu">
            <li>
              <a class="identity-change" href="/home" value="STUDENT">学生</a>
            </li>
          </ul>
        </li>
        <!--</ul>-->
        <!--</li>-->

        

        <li id="managerMessage" style="position: relative;">
          <a href="#">消息<span class="point hide"></span></a>
        </li>

        <li class="dropdown hidden-sm hidden-xs" id="accountManagement" style="flex: 0 1 auto;">
          <!--<a data-toggle="dropdown" class="dropdown-toggle" href="#" style="padding: 16px 0;">-->
          <!--<img style="width: 20px; height: 20px; border-radius:50%" id="portrait"/>-->
          <!--<i class="fa personName"></i>  <i class="fa fa-angle-down"></i>-->
          <!--</a>-->
          <!--<ul role="menu" class="dropdown-menu" id="accountManagementList">-->
          <!--</ul>-->
        </li>

        <!--<li class="dropdown hidden-sm hidden-xs" id="language-switcher">
          <a id="language-switcher-zh" style="display:none;"><div></div></a>
          <a id="language-switcher-en" style="display:none;"><div></div></a>
        </li>-->

        <li class="dropdown" style="display: none">
          <a aria-expanded="false" class="dropdown-toggle" data-toggle="collapse" href="#" id="show-todo" role="button" style="font-size: 19px">
            <i class="fa fa-list-ul"></i>
            <div class="e-corner-mark-red" id="todoCount"></div>
          </a>

          <div id="todo-list" style="display: none;">
            <div class="container-fluid">
              <div class="todos-title">
                <i class="text-primary fa fa-angle-double-right close-todo-list"></i><span style="color:#515151; padding-left: 5px">我的待办</span>
              </div>

              <hr />

              <table class="table undone todos-table" width="100%">
                <tbody>
                </tbody>
              </table>

              <div class="buttons">
              </div>

              <table class="table done todos-table" width="100%">
                <tbody>
                </tbody>
              </table>
            </div>
          </div>
        </li>

      </ul>

    </div>
    <!-- /.navbar-collapse -->

    <!--</div>-->

  </nav>

</header>



<div id="e-content-area">
  <!--<div id="bizTypeSelectPlace"></div>-->


  <!-- operation area -->
  <div id="e-op-area">

    <div class="container-fluid e-toolbarTab">
      <!-- page header -->
      <!--<div class="toolbarView"></div>-->

      <!-- /.page header -->

      <div class="embed-responsive e-op-area-iframe-container" style="border: green">

        <h1 class="text-muted hide" id="home-loading">正在加载...</h1>
        <div id="home-page">
          <!--<div id="welcomeTitle">-->
          <!--<p><span>欢迎使用教务管理系统</span></p>-->
          <!--</div>-->
          <div id="suspension"></div>
          <div class="container-fluid" id="content">
            <div class="carousel slide primary-container" data-interval="false" id="primaryCarousel">
              <div class="primary carousel-inner">

              </div>
              <a class="left carousel-control" data-slide="prev" href="#primaryCarousel">
                <span class="fa fa-angle-left"></span>
                <span class="sr-only">Previous</span>
              </a>
              <a class="right carousel-control" data-slide="next" href="#primaryCarousel">
                <span class="fa fa-angle-right"></span>
                <span class="sr-only">Next</span>
              </a>
            </div>

            <div id="shortcut-setting">
              <div class="toggle-arrow">
                <i class="fa fa-chevron fa-angle-up shortcutShow">
                </i>
                <!--<span class="hide shortcutTip">快捷入口</span>-->
                <!--<i class="fa fa-2x fa-chevron fa-chevron-up shortcutShow"></i>-->

              </div>
              <div class="hide shortcut-container">
                <div id="shortcut"></div>

              </div>
            </div>
          </div>
          <div id="modalPlace"></div>
          <div id="bgkModalPlace"></div>
          <div id="primaryModalPlace"></div>
          <div id="portraitModalPlace"></div>
        </div>


      </div>

    </div>
    <!-- /.page iframe -->
  </div>
  <!-- /.operation area -->

</div>

<!--template-->
<template id="identity-tpl">
  <li>
    <a class="identity-change" href="/home" value="STUDENT">
      <i class="icon-sy icon-sy-identity"></i>
      <span>学生</span>
    </a>
  </li>
</template>
<!--template-->

<!-- teacher modal -->
<div aria-labelledby="myLargeModalLabel" class="modal fade modal-wide" id="assign" role="dialog" tabindex="-1">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <button aria-label="Close" class="close" data-dismiss="modal" type="button"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title text-center">选择指派给谁</h4>
      </div>
      <div class="modal-body teacher-content">
        <select class="form-control selectize ajax-select" id="assignee" name="assignee" placeholder="请输入教师学号,姓名查询"></select>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" data-dismiss="modal" id="chooseAssignee" type="button">确定</button>
        <button class="btn btn-default" data-dismiss="modal" type="button">关闭</button>
      </div>
    </div>
  </div>
</div>
<!-- ./teacher modal -->
<script src="/static/eams-ui/js/eams-ui-home.js"></script>
<!--<script th:src="@{/static/todo/js/todo.js}"></script>-->
<script src="/static/eams-ui/js/require.js"></script>
<script src="/static/home/js/main.js?v=3"></script>
<script src="/static/md5/js/md5.js"></script>
<!--<script th:src="@{/static/dogNew.js}"></script>-->
<script>
  /*<![CDATA[*/
  $(function () {
    var bizTypes = null;
    var personName = '\u8D75\u5955';
    var accountId = 196164;
    var hasAvatar = false;
    var defaultAvatar = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAgMAAACJFjxpAAAADFBMVEXFxcX////p6enW1tbAmiBwAAAFiElEQVR4AezAgQAAAACAoP2pF6kAAAAAAAAAAAAAAIDbu2MkvY0jiuMWWQoUmI50BB+BgRTpCAz4G6C8CJDrC3AEXGKPoMTlYA/gAJfwETawI8cuBs5Nk2KtvfiLW+gLfK9m+r3X82G653+JP/zjF8afP1S//y+An4/i51//AsB4aH+/QPD6EQAY/zwZwN8BAP50bh786KP4+VT+3fs4/noigEc+jnHeJrzxX+NWMDDh4g8+EXcnLcC9T8U5S/CdT8bcUeBEIrwBOiI8ki7Ba5+NrePgWUy89/nYyxQ8Iw3f+pWY4h1gb3eAW7sDTPEOsLc7wK1TIeDuDB+I/OA1QOUHv/dFsZQkhKkh4QlEfOULYz2nGj2/Nn1LmwR/86VxlCoAW6kCsHRGANx1RgCMo5Qh2EsZgrXNQZZShp5Liv7Il8eIc5C91EHY2hxk6bwYmNscZIReDBwtCdhbErC1JGBpScBcOgFMLQsZMQs5Whayd+UQsLYsZGlZyNyykKllISNmIUfAwifw8NXvTojAjGFrdYi11SGWVoeYWx1i6lmQCiEjFkKOVgjZ+xxIhZCtFULWHkCqxCw9gNQKmP9vNHzipdEPrRcxtVbAeDkAvve0iM2QozVD9hfjhp4YP/UrkJYDbD2AtBxgfSkAvvHEeNcDSAsilgtAWxIy91J8AXgZAJ5e33+4tuACcAG4AFwALgBXRXQB6AFcB5MXAuA6nl9/0Vx/011/1V5/1/dfTPJvRtdnu/zL6beeFO/7r+fXBYbrEkt/j+i6ytXfpuvvE/ZXOnsA/a3a/l5xf7O6v1t+Xe/vOyz6HpO8yyboM8o7rfJes77bru83THk48p7TvOs27zvOO6/73vO++z7l4cgnMPQzKPopHC0N9noSSz6LJp/Gk88jyicy5TOp6qlc+VyyfDJbPpuuns6XzyfMJzTmMyrrKZ35nNJ8Ums+q7af1tvPK+4nNodEnPKp3fnc8npyez67/qVP7+/fL8hfcMjfsOhf8cjfMclfcnn9+BkOnLECP8Q58OYeyJ40eoyF6Ee/En/JHlP6mIlRVXprF4BxtAvArV0AxtEuALd2ARhHuwDc2gVgHPX/hFv9fMBddjIGeKg/WCxlCsI46u+Ga5mCcJd+sIG9UkGAW32ZbApFAHhod4Bb3eo04h3god0BbiUHYApVCNjbHeBW+QDAXT4a7qg7r7e214057vg0QhkEHkoSwq0kIdydXw4/Q3H8hjYJ3vL0WConBJhCHQaOToeBrU0BljYFmEoVgHGUKgAPnREAt84IgLuqFgAYSUEOAHszDwuAtSkHAZhLGYIpdCLgKGUIHtocZG1zkLmUIRhxDnJU1RDA1uYga5uDzKUOwhTnIEfnxcDe5iBrcyQAYGlzkKkUYhhxDrKXQgxbSwLWUohhbknA1JKAEZOAvSUBW0sC1pYEzC0JmFoSMMJyCDhaFrK3JGDtyiFgaVnI3LKQqWUhI2YhR8tC9paFrC0LWVoWMrcsZGpZyIhZyNGykL2rSIGtlQHWVgZYWhlgbmWAqZUBRiwDHK0MsLcywNbKAGsOoNUhllaHmFsdYmp1iBHrEEerQ+w5gFYI2VodYm11iKXVIeYcQCuETK0QMmIh5MgBtELI3gohWyuErDmAVolZWiFkzgG0SszUKjGjfj6gVmKOVonZcwCtFbB9HQC+ozWDbz1bvGu9iKW1AuYcQOtFTLEX1GbIaFegN0OOHEBrhuw5gNYM2XIArRuz5gDacoB3bTnAEktxXQ4wfw0AvveM8b4tiJjSJOwLIsbXsAKeNeKCiOO3D+AVbUl0AfjGs8ZPbUnIdgFoa1LWC0BblfMuB9AeC1j6gqQE0J9LmC8AOYD2ZMb7i4bt2ZTpWoHfPoB7Tj2fXzT8N1X41vkq/QHOAAAAAElFTkSuQmCC';
    var bgk = null;
    var defaultBizType = null;
    var currentBizTypeId = null

    if (bgk) {
      //有默认的
      var bgkArr = bgk.split('||');
      if (bgkArr[0] == 'uploadBgk') {
        var bgkUrl = window.location.origin + window.CONTEXT_PATH + '/account/background-photo';

        $('body.e-home-bg1').css('background-image', "url(" + bgkUrl + ")");
        window.localStorage.setItem('bodyBgk', 'background-image|| url("' + bgkUrl + '")')
      } else {
        $('body.e-home-bg1').css(bgkArr[0], "url(\'" + window.CONTEXT_PATH + bgkArr[1] + "\')");
        window.localStorage.setItem('bodyBgk', bgkArr[0] + '||' + bgkArr[1]);
      }
    } else {
      //没有
      $('body.e-home-bg1').addClass('default-bgk')
      window.localStorage.setItem('bodyBgk', 'background-image||' + $('body.e-home-bg1').css('background-image'))

    }

    if (currentBizTypeId != null) {
      defaultBizType.id = currentBizTypeId;
    }

    var finereportTargetUrl = 'https://jw.ustc.edu.cn/webroot/decision';

    refreshViews(defaultBizType, bizTypes, personName, hasAvatar, defaultAvatar, finereportTargetUrl);

    // 登录fine
    var username = 'PB21000033';
    var fineReportPw = '1992115511';
    var password = hex_md5(fineReportPw);
    var url = finereportTargetUrl + "/login/cross/domain" + "?fine_username=" + encodeURIComponent(username) + "&fine_password=" + password + "&validity=" + -1;
    $.ajax({
      url: url,//单点登录的管理平台报表服务器
      timeout: 5000,//超时时间（单位：毫秒）
      dataType: "jsonp",//跨域采用jsonp方式
      jsonp: "callback",
      success: function (res) {
        /*console.log(res);
        if (res.errorCode) {
          window.alert(res.errorMsg);
        }else {
          // 保存token并跳转到对应链接
          window.location.href = "https://test.cmet.ustc.edu.cn/webroot/decision";
        }*/
      },
      error: function () {
        /*alert("超时或服务器其他错误");// 登录失败（超时或服务器其他错误）*/
      }
    });


    // 意见反馈
    $('#suggestions').attr('href', 'https://support.qq.com/product/85345?openid=' + username + '&nickname=' + username + '&avatar=https://tucao.qq.com/static/desktop/img/products/def-product-logo.png');

  });

  $(".shortcutShow, .shortcutHide").mouseover(function (e) {
    var $target = $(e.target);
    $target.siblings("span").removeClass('hide')
  })

  $(".shortcutShow, .shortcutHide").mouseleave(function (e) {
    var $target = $(e.target);
    $target.siblings("span").addClass('hide')
  })

  //
  $(".shortcutShow").click(function (e) {
    var $target = $(e.target);
    $target.parent().find('span').toggleClass('hide')
//    $target.next().removeClass('hide')
//    $target.addClass('hide')
    $(".shortcut-container").toggleClass('hide')
    $target.toggleClass("rotate")
  });

  //  $(".shortcutHide").click(function (e) {
  //    var $target = $(e.target);
  //    $target.prev().removeClass('hide')
  //    $target.addClass('hide');
  //    $(".shortcut-container").addClass('hide')
  //  })

  $("#biztype-change").hover(function (e) {
    $("#biztype-change").addClass('open')

  }, function (e) {
    $("#biztype-change").removeClass('open')
  })

  $("#accountManagement").hover(function (e) {
    $("#accountManagement").addClass('open')

  }, function (e) {
    $("#accountManagement").removeClass('open')
  })

  $("#identity-change").hover(function (e) {
    $("#identity-change").addClass('open')

  }, function (e) {
    $("#identity-change").removeClass('open')
  })

  //身份切换onclick
  $("#identity-change a.identity-change").on('click', function (e) {
    var $e = $(e.target);
    var type = $e.attr("value");
    e.preventDefault();
    e.stopPropagation();
    $.post({
      url: window.CONTEXT_PATH + '/individual-setting/save-setting',
      data: JSON.stringify(["navigation-identity", type]),
      contentType: "application/json",
      success: function (res) {
        if (!res.success) {
          return false;
        }
        window.location.href = $e.attr("href");
      }
    });
  })

  //可视窗口高度
  var visibleWindowHeight = $(window).height();

  //header高度
  var pageHeaderPadding = 15;
  var pageHeader = 30;
  var headerHeight = $("header.e-header").outerHeight() + pageHeader + pageHeaderPadding;

  //footer高度
  var footerHeight = $("footer.e-home-footer").outerHeight();

  var iframeHeight = visibleWindowHeight - 45;

  $("#home-page").css({height: iframeHeight, overflow: "auto"});

  window.onresize = function () {
    window.visibleWindowHeight = $(window).height();
    window.pageHeaderHeight = $(".e-page-header").height();
    iframeHeight = visibleWindowHeight - pageHeaderHeight;
//    var iframeWidth = $(window).width();
    $("#home-page").css({height: iframeHeight});
//    $(".embed-responsive.e-op-area-iframe-container").css({height:iframeHeight,width:iframeWidth});
    $(".embed-responsive.e-op-area-iframe-container").css({height: iframeHeight});
    var resizeToolbarView = function () {
      var $toolbarView = $(".toolbarView");
      var width = $(".e-header .navbar-collapse").outerWidth();
      $toolbarView.siblings("ul").each(function (index, item) {
        width -= $(item).outerWidth();
      });
      $toolbarView.width(width - 20);
    }()
  };

  var postLanguageSetting = function (type) {
    var args = ['navigation-language', type];
    $.post({
      url: window.CONTEXT_PATH + '/individual-setting/save-setting',
      async: false,
      data: JSON.stringify(args),
      contentType: "application/json",
      success: function (res) {
      }
    })
  };

  // var saveIdentity = function (e) {
  //   debugger
  //   var $e = $(e.target);
  //   var type = $e.attr("value");
  //   $.post({
  //     url: window.CONTEXT_PATH + '/individual-setting/save-setting',
  //     data: JSON.stringify(["navigation-identity",type]),
  //     contentType: "application/json",
  //     success: function (res) {
  //     }
  //   });
  // }

  /*$("#language-switcher-zh").click(function (event) {
   var type = 'en';
   Cookies.set('user_locale', type);
   postLanguageSetting(type);
   window.location.reload();
   });
   $("#language-switcher-en").click(function (event) {
   var type = 'zh';
   Cookies.set('user_locale', type);
   postLanguageSetting(type);
   window.location.reload();
   });*/

  var user_locale = Cookies.get("user_locale");
  if (!user_locale) {
    Cookies.set('user_locale', 'zh');
    user_locale = 'zh';
  }
  var language = null;
  if (language != null && user_locale != language) {
    Cookies.set('user_locale', language);
    window.location.reload();
  }

  /*$("#language-switcher-" + user_locale).show();*/
  $("body").attr("data-lang", user_locale);

  //判断消息是否有未读数
  var redPoint = function () {
    setTimeout(function () {
      $.ajax({
        url: window.CONTEXT_PATH + '/my/check-has-new-notification',
        type: 'get',
        success: function (res) {
          if (res) {
            $("#managerMessage .point").removeClass('hide');
          } else {
            $("#managerMessage .point").addClass('hide');
          }

          redPoint();
        }
      })
    },10000);
  };

  redPoint();

  /*]]>*/
</script>

</body>
<script>
  /*<![CDATA[*/
  $(function () {
    //排除多个iframe的情况(开课计划,学生课表等)
    if (window.frameElement && window.frameElement.name != 'generate-course-plan' && window.frameElement.name != 'student-grades') {
      $(".path-nav").removeClass('hide');

      //路径导航
      function initMenu(menus, initParentId) {
        var $home_li = $("<li class='dropdown home dropdown-hover'></li>");
        var $home_a = $("<a></a>").addClass("dropdown-toggle")
            .attr("role", "button").attr("data-toggle", "dropdown")
            .attr("aria-haspopup", true).attr("aria-expanded", false)
            .attr("href", "#")
            .text('首页>')

        var $home_ul = $("<ul></ul>")
            .addClass("dropdown-menu").attr('aria-labelledby', 'drop_0');

        var allMenus = getMenus(menus, initParentId);
        if (allMenus && allMenus.length != 0) {
          $.each(allMenus, function (i, menu) {
            if (i == 0) {
              return;
            }
            $home_ul.append(menu);
          });
          $home_li.append($home_a.append("")).append($home_ul);
          $home_li.find("[appendDivider=true]").each(function () {
            $(this).closest('li').after("<li class='divider'></li>");
          });
          $("#path-nav-home").append($home_li);
        }


        $(".dropdown-hover a:first").dropdownHover({
          changePosition: true
        });


      }

      function getMenus(menus, parentID) {
        var $iframeContainer = $('#e-op-area .e-op-area-iframe-container');
        var iframeHomeName = "e-home-iframe";
        var $iframeHome = $iframeContainer.find('iframe[name=' + iframeHomeName + ']');
        var home_src = $iframeHome.attr("src");
        var $home_a = $("<a></a>").addClass("dropdown-toggle")
            .attr("role", "button").attr("data-toggle", "dropdown")
            .attr("aria-haspopup", true).attr("aria-expanded", false)
            .attr("href", "#");

        return menus.filter(function (node) {
          return (node.parentId === parentID);
        }).map(function (node) {
          var exists = menus.some(function (childNode) {
            return childNode.parentId === node.id;
          });

          var $ul = $("<ul></ul>").addClass("dropdown-menu").attr('aria-labelledby', "drop_" + node.id);
          var subMenu = (exists) ? $ul.append(getMenus(menus, node.id)) : "";
          var $li = $("<li></li>");
          var $a = $("<a></a>");
          $a.attr("id", "drop_" + node.id);
          $a.attr("class", "drop_submenu");
          $a.attr("href", node.href);
          $a.text(node.title);

          //如果是home页面设置target为e-home-iframe
          if (node.href === home_src) {
            $a.attr("target", "e-home-iframe");
            $home_a.text(node.title);
          }
          if (node.parentId) {
            $a.attr("parentId", "drop_" + node.parentId);
          }
          $a.attr('appendDivider', node.appendDivider);
          if (subMenu != "") {
            $li.addClass("dropdown-submenu");
          }
          return $li.append($a).append(subMenu);
        });
      }

      function updateMenu($anchor) {
        var drop_parentId = $anchor.attr("parentId");

        var $menu_list = $("#path-nav-home").find("ul[aria-labelledby='" + drop_parentId + "']").removeAttr("style");
        if ($menu_list.length != 0) {
          var $new_li = $("<li></li>").addClass("dropdown children dropdown-hover");
          var $new_a = $("<a></a>").addClass("dropdown-toggle")
              .attr("role", "button").attr("data-toggle", "dropdown")
              .attr("aria-haspopup", true).attr("aria-expanded", false)
              .text($anchor.text());

          $new_li.append($new_a)

          //查找上一级菜单
          var $parent_anchor = $("#path-nav-home").find("a[id='" + drop_parentId + "']");

          if ($menu_list.find("li").length > 1) {
            $new_a.append("<span class='fa fa-angle-right'></span>");
            $new_li.append($menu_list.clone(true));
          }

          $("#path-nav-home").find("li:first").after($new_li);

          updateMenu($parent_anchor);
        } else {
          $("#path-nav-home").find("li a:first").text($anchor.text()).append("<span class='fa fa-angle-right'></span>");
        }

        $(".dropdown-hover a[class='dropdown-toggle']").dropdownHover({
          changePosition: true
        });

      }

      if (typeof parent.$('#saveMenus').val() != 'undefined') {
          var menus = JSON.parse(parent.$('#saveMenus').val());

          initMenu(menus, "");
          var targetMenu = menus.filter(function (menu) {
              return menu.href == $(window.frameElement).attr('src')
          })[0]
          if (targetMenu) {
              var $anchor = $('<a href="' + targetMenu.href + '" id="drop_' + targetMenu.id + '" parentId="drop_' + targetMenu.parentId + '">' + targetMenu.title + '</a>');

              updateMenu($anchor);
          }
      }

      var originName = '首页 ';
      $("#path-nav-home").find('>li').each(function (index, li) {
        var currentName = $(li).find('>a').text();
        $(li).find('>a').text(originName + ' > ');
        originName = currentName;
      });
      originName = originName.indexOf('首页') != -1 ? '': originName;
      $("#path-nav-home").append('<li><span style="color:#999999">&nbsp;' + originName + '</span></li>');


      $('.drop_submenu').click(function (e) {
        clickSubMenu(e, '');
      });

      function clickSubMenu(e, queryString) {
        var $this = $(e.target);

        var $body = $("body");
        if (!$this.attr('href') || $this.attr('href') == '#') {
          e.target.style.backgroundColor = 'transparent';
          return false;
        }

        e.preventDefault();
        $body.find(".dropdown-toggle-hover").removeClass("dropdown-toggle-hover");

        parent.$("#e-top-menu").find('a[href="' + $this.attr('href') + '"]').click();

      }

    }

  });
  /*]]>*/
</script>

</body>

<script>
  /*<![CDATA[*/
  $(function () {
    $.each($(".selectized"), function () {
      var _self = this;
      if ($(_self)[0].tagName == 'SELECT') {
        $(_self)[0].selectize.on('focus', function () {
          if ($(_self)[0].selectize.getValue() == '') {
            $(_self)[0].selectize.clear();
          }
        });
      }
    });

    Date.prototype.format = function (format) {
      var date = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S+": this.getMilliseconds()
      };
      if (/(y+)/i.test(format)) {
        format = format.replace(RegExp.$1, (this.getFullYear() + '').substr(4 - RegExp.$1.length));
      }
      for (var k in date) {
        if (new RegExp("(" + k + ")").test(format)) {
          format = format.replace(RegExp.$1, RegExp.$1.length == 1
              ? date[k] : ("00" + date[k]).substr(("" + date[k]).length));
        }
      }
      return format;
    };
    var refreshTab = function (e) {
      e.preventDefault();

      document.location.reload();
    };

    $("#refresh").click(refreshTab);


    /*
    * validator插件验证后跳转第一个invalid处，兼容selectize
    * */
    $.validator.prototype.focusInvalid = function () {
      if ( this.settings.focusInvalid ) {
        try {
          var $el = $( this.findLastActive() || this.errorList.length && this.errorList[ 0 ].element || []);

          if($el.is(":visible")){
          $el.focus()
            // manually trigger focusin event; without it, focusin handler isn't called, findLastActive won't have anything to find
                .trigger( "focusin" );
          }else if($el[0].selectize){
            $el[0].selectize.focus();
          }
        } catch ( e ) {
          // ignore IE throwing errors when focusing hidden elements
        }
      }
    }

    //STORY #19848 系统级调整：功能未开放实现方式
    if (FormUtil) {
      $(".switchCheckModel").modal({
        backdrop: true,
        show: false
      });

      FormUtil.get = new Proxy(FormUtil.get, {
        apply: function (target, thisArg, args) {
          if (args[0].checkSwitch && !FormUtil.checkOpenSwitch(args[0].url, 'GET')) {
            return false;
          }
          return target.call(thisArg, ...args);
        }
      });

      FormUtil.post = new Proxy(FormUtil.post, {
        apply: function (target, thisArg, args) {
          if (args[0].checkSwitch && !FormUtil.checkOpenSwitch(args[0].url, 'POST')) {
            return false;
          }
          return target.call(thisArg, ...args);
        }
      });

      FormUtil.isOpenSwitch = function (url, data) {
        var checkOpen = true;
        $.ajax({
          url: url,
          type: 'get',
          async: false,
          data: data,
          success: function (res) {
            if (!res.success) {
              checkOpen = false;

              $(".switchCheckModel .switchMessage").text('功能未开放');
              if (res.openDate) {
                $(".switchCheckModel .openDate").text(res.openDate);
                $(".switchCheckModel .openDateMsg").show();
              } else {
                $(".switchCheckModel .openDate").text('');
                $(".switchCheckModel .openDateMsg").hide();
              }
              if (res.bulletin) {
                //公告
              }
              $(".switchCheckModel").modal('show');
            }
          }
        });

        return checkOpen;
      }
      //开关未开放弹窗，如果开关数据在MODULE_SWITCH表中，使用（FormUtil.isOpenSwitchByModule），如果不在，就用 （switchAlterWindow（））
      FormUtil.isOpenSwitchByModule = function (module, bizTypeId, semesterId) {
        var checkOpen = true;
        $.ajax({
          url: window.CONTEXT_PATH + '/ws/switch/is-open',
          type: 'get',
          async: false,
          data: {module: module, bizType: bizTypeId, semester: semesterId},
          success: function (res) {
            if (!res.success) {
              checkOpen = false;

              $(".switchCheckModel .switchMessage").text('功能未开放');
              if (res.openDate) {
                $(".switchCheckModel .openDate").text(res.openDate);
                $(".switchCheckModel .openDateMsg").show();
              } else {
                $(".switchCheckModel .openDate").text('');
                $(".switchCheckModel .openDateMsg").hide();
              }
              if (res.bulletin) {
                //公告
              }
              $(".switchCheckModel").modal('show');
            }
          }
        });

        return checkOpen;
      }

      FormUtil.checkOpenSwitch = function (targetUrl, targetMethod) {
        var checkOpen = true;
        $.ajax({
          url: window.CONTEXT_PATH + '/ws/switch/check-open',
          type: 'get',
          async: false,
          data: {targetUrl: targetUrl, targetMethod: targetMethod.toUpperCase()},
          success: function (res) {
            if (!res.success) {
              checkOpen = false;

              $(".switchCheckModel .switchMessage").text(res.message);
              if (res.openDate) {
                $(".switchCheckModel .openDate").text(res.openDate);
                $(".switchCheckModel .openDateMsg").show();
              } else {
                $(".switchCheckModel .openDate").text('');
                $(".switchCheckModel .openDateMsg").hide();
              }
              if (res.bulletin) {
                //公告
              }
              $(".switchCheckModel").modal('show');
            }
          }
        });

        return checkOpen;
      }
      FormUtil.showOpenSwitch = function (message, openDate, bulletin) {
        $(".switchCheckModel .switchMessage").text(message);
        if (openDate) {
          $(".switchCheckModel .openDate").text(openDate);
          $(".switchCheckModel .openDateMsg").show();
        } else {
          $(".switchCheckModel .openDate").text('');
          $(".switchCheckModel .openDateMsg").hide();
        }
        if (bulletin) {
          //公告
        }
        $(".switchCheckModel").modal('show');
      }

    }
  });
  /*]]>*/
</script>



</html>

